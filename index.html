<!doctype html>
<html lang="pl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>O≈õwiadczenie powypadkowe ‚Äì PoC</title>
  <link rel="stylesheet" href="/style.css">
  
  <!-- Debug console for mobile -->
  <script>
    // Dodaj debug console dla urzƒÖdze≈Ñ mobilnych
    if (window.location.search.includes('debug=1') || /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
      document.addEventListener('DOMContentLoaded', function() {
        // Stw√≥rz prostƒÖ konsolƒô debug
        const debugConsole = document.createElement('div');
        debugConsole.id = 'debug-console';
        debugConsole.style.cssText = `
          position: fixed;
          top: 10px;
          right: 10px;
          width: 300px;
          max-height: 400px;
          background: rgba(0,0,0,0.8);
          color: white;
          font-family: monospace;
          font-size: 12px;
          padding: 10px;
          border-radius: 5px;
          z-index: 10000;
          overflow-y: auto;
          display: none;
        `;
        document.body.appendChild(debugConsole);
        
        // Przycisk toggle
        const debugBtn = document.createElement('button');
        debugBtn.textContent = 'DEBUG';
        debugBtn.style.cssText = `
          position: fixed;
          top: 10px;
          right: 10px;
          background: #007bff;
          color: white;
          border: none;
          padding: 10px;
          border-radius: 5px;
          z-index: 10001;
          font-size: 12px;
        `;
        debugBtn.onclick = () => {
          debugConsole.style.display = debugConsole.style.display === 'none' ? 'block' : 'none';
        };
        document.body.appendChild(debugBtn);
        
        // Override console.log
        const originalLog = console.log;
        console.log = function(...args) {
          originalLog.apply(console, args);
          const debugDiv = document.getElementById('debug-console');
          if (debugDiv) {
            const logEntry = document.createElement('div');
            logEntry.textContent = args.join(' ');
            logEntry.style.marginBottom = '5px';
            debugDiv.appendChild(logEntry);
            debugDiv.scrollTop = debugDiv.scrollHeight;
          }
        };
        
        console.log('üîß Debug console enabled for mobile');
      });
    }
  </script>
    <style>
      .photo-item {
        display: flex !important;
        align-items: center !important;
        padding: 12px !important;
        margin: 8px 0 !important;
        background-color: #f8f9fa !important;
        border: 1px solid #e9ecef !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
      }
      
      .photo-icon {
        font-size: 12px !important;
        margin-right: 6px !important;
        flex-shrink: 0 !important;
        width: 16px !important;
        height: 16px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        background-color: #f0f0f0 !important;
        border-radius: 2px !important;
        border: 1px solid #ddd !important;
      }
      
      .photo-info {
        flex: 1 !important;
        margin-right: 12px !important;
      }
      
      .photo-name {
        font-weight: 500 !important;
        color: #333 !important;
        margin-bottom: 4px !important;
        word-break: break-all !important;
      }
      
      .photo-size {
        font-size: 12px !important;
        color: #666 !important;
      }
      
           .photo-preview-container {
             position: relative !important;
             flex-shrink: 0 !important;
           }
           
           .photo-preview {
             width: 60px !important;
             height: 60px !important;
             object-fit: cover !important;
             border-radius: 4px !important;
             border: 1px solid #ddd !important;
             flex-shrink: 0 !important;
           }
           
           .photo-delete-btn {
             position: absolute !important;
             top: -8px !important;
             right: -8px !important;
             width: 20px !important;
             height: 20px !important;
             border-radius: 50% !important;
             background-color: #ff4444 !important;
             color: white !important;
             border: none !important;
             font-size: 14px !important;
             font-weight: bold !important;
             cursor: pointer !important;
             display: flex !important;
             align-items: center !important;
             justify-content: center !important;
             box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
             transition: background-color 0.2s !important;
           }
           
           .photo-delete-btn:hover {
             background-color: #cc0000 !important;
           }
      
      .no-photos {
        text-align: center !important;
        color: #666 !important;
        font-style: italic !important;
        padding: 20px !important;
        background-color: #f8f9fa !important;
        border-radius: 8px !important;
        border: 2px dashed #dee2e6 !important;
      }
    </style>
  </head>
  <body>
    <!-- Baner reklamowy -->
    <div class="ad-banner">
      <div class="ad-content">
        <span class="ad-label">REKLAMA</span>
        <div class="ad-text">
          <strong>Likwidacja szk√≥d samochodowych - Szybko i profesjonalnie!</strong> 
          Bezp≈Çatna wycena, naprawa w autoryzowanym serwisie, zastƒôpczy samoch√≥d. 
          <a href="#" class="ad-link">Zg≈Ço≈õ szkodƒô ‚Üí</a>
        </div>
      </div>
    </div>

    <div class="container">
      <div id="speechBanner" class="speech-banner hidden" role="status" aria-live="assertive">
        <span class="dot" aria-hidden="true"></span>
        <div class="speech-texts">
          <div>System nagrywa i przyjmuje o≈õwiadczenie g≈Çosowe. M√≥w wyra≈∫nie...</div>
          <div id="speechLiveText" class="live-text"></div>
        </div>
      </div>
      <div id="aiStatus" class="ai-status hidden" role="status" aria-live="polite"></div>
      <h1 class="main-title">O≈õwiadczenie sprawcy kolizji drogowej</h1>
      
      <!-- Wyb√≥r trybu wype≈Çniania -->
      <div class="mode-selection">
        <button type="button" id="wizardBtn" class="mode-btn wizard-btn">
          <span class="mode-icon">ü§ñ</span>
          <span class="mode-title">Wizard AI</span>
        </button>
        <button type="button" id="manualBtn" class="mode-btn manual-btn active">
          <span class="mode-icon">‚úèÔ∏è</span>
          <span class="mode-title">Rƒôczne</span>
        </button>
      </div>
      
      <!-- Wizard AI -->
      <div id="wizardSection" class="wizard-section hidden">
        <div class="wizard-container">
          <div class="wizard-header">
            <h2>ü§ñ Wizard AI</h2>
            <p class="wizard-description">Wizard poprowadzi Ciƒô przez proces zbierania danych i automatycznie wype≈Çni formularz</p>
          </div>
          
          <div class="wizard-content">
            <!-- Krok 1: Prawo jazdy sprawcy - prz√≥d i ty≈Ç -->
            <div id="wizardStep1" class="wizard-step active">
              <h3>üìÑ Prawo jazdy sprawcy</h3>
              <p>Zdjƒôcia przedniej i tylnej strony prawa jazdy sprawcy</p>
              <div class="photo-upload-area" id="licenseAUpload">
                <input type="file" id="licenseAFile" accept="image/*" capture="environment" multiple>
                <div class="upload-placeholder">
                  <span class="upload-icon">üì∑</span>
                  <span class="upload-text">Kliknij aby zrobiƒá zdjƒôcia (prz√≥d i ty≈Ç prawa jazdy)</span>
                </div>
                <div id="licenseAPreviews" class="upload-previews"></div>
              </div>
            </div>

            <!-- Krok 2: Prawo jazdy poszkodowanego - prz√≥d i ty≈Ç -->
            <div id="wizardStep2" class="wizard-step">
              <h3>üìÑ Prawo jazdy poszkodowanego</h3>
              <p>Zdjƒôcia przedniej i tylnej strony prawa jazdy poszkodowanego</p>
              <div class="photo-upload-area" id="licenseBUpload">
                <input type="file" id="licenseBFile" accept="image/*" capture="environment" multiple>
                <div class="upload-placeholder">
                  <span class="upload-icon">üì∑</span>
                  <span class="upload-text">Kliknij aby zrobiƒá zdjƒôcia (prz√≥d i ty≈Ç prawa jazdy)</span>
                </div>
                <div id="licenseBPreviews" class="upload-previews"></div>
              </div>
            </div>

            <!-- Krok 3: Pojazd poszkodowanego - prz√≥d i ty≈Ç -->
            <div id="wizardStep3" class="wizard-step">
              <h3>üöó Pojazd poszkodowanego</h3>
              <p>Zdjƒôcia pojazdu poszkodowanego z przodu i z ty≈Çu z widocznymi tablicami rejestracyjnymi</p>
              <div class="photo-upload-area" id="vehicleBUpload">
                <input type="file" id="vehicleBFile" accept="image/*" capture="environment" multiple>
                <div class="upload-placeholder">
                  <span class="upload-icon">üì∑</span>
                  <span class="upload-text">Kliknij aby zrobiƒá zdjƒôcia (prz√≥d i ty≈Ç z tablicami)</span>
                </div>
                <div id="vehicleBPreviews" class="upload-previews"></div>
              </div>
            </div>

            <!-- Krok 4: Pojazd sprawcy - prz√≥d i ty≈Ç -->
            <div id="wizardStep4" class="wizard-step">
              <h3>üöó Pojazd sprawcy</h3>
              <p>Zdjƒôcia pojazdu sprawcy z przodu i z ty≈Çu z widocznymi tablicami rejestracyjnymi</p>
              <div class="photo-upload-area" id="vehicleAUpload">
                <input type="file" id="vehicleAFile" accept="image/*" capture="environment" multiple>
                <div class="upload-placeholder">
                  <span class="upload-icon">üì∑</span>
                  <span class="upload-text">Kliknij aby zrobiƒá zdjƒôcia (prz√≥d i ty≈Ç z tablicami)</span>
                </div>
                <div id="vehicleAPreviews" class="upload-previews"></div>
              </div>
            </div>

            <!-- Krok 5: Uszkodzenia pojazdu poszkodowanego -->
            <div id="wizardStep5" class="wizard-step">
              <h3>üîß Uszkodzenia pojazdu poszkodowanego</h3>
              <p>Zdjƒôcia uszkodzonych element√≥w pojazdu poszkodowanego (max. 5 zdjƒôƒá)</p>
              <div class="photo-upload-area" id="damageBUpload">
                <input type="file" id="damageBFile" accept="image/*" capture="environment" multiple>
                <div class="upload-placeholder">
                  <span class="upload-icon">üì∑</span>
                  <span class="upload-text">Kliknij aby zrobiƒá zdjƒôcia uszkodze≈Ñ (max. 5)</span>
                </div>
                <div id="damageBPreviews" class="upload-previews"></div>
              </div>
            </div>

            <!-- Krok 6: Uszkodzenia pojazdu sprawcy -->
            <div id="wizardStep6" class="wizard-step">
              <h3>üîß Uszkodzenia pojazdu sprawcy</h3>
              <p>Zdjƒôcia uszkodzonych element√≥w pojazdu sprawcy (max. 5 zdjƒôƒá)</p>
              <div class="photo-upload-area" id="damageAUpload">
                <input type="file" id="damageAFile" accept="image/*" capture="environment" multiple>
                <div class="upload-placeholder">
                  <span class="upload-icon">üì∑</span>
                  <span class="upload-text">Kliknij aby zrobiƒá zdjƒôcia uszkodze≈Ñ (max. 5)</span>
                </div>
                <div id="damageAPreviews" class="upload-previews"></div>
              </div>
            </div>

            <!-- Krok 7: Lokalizacja i szczeg√≥≈Çy -->
            <div id="wizardStep7" class="wizard-step">
              <h3>üìç Lokalizacja i szczeg√≥≈Çy zdarzenia</h3>
              <div class="wizard-form">
                <label>Lokalizacja zdarzenia
                  <input type="text" id="wizardLocation" placeholder="np. ul. Krakowska 15, Krak√≥w">
                  <button type="button" id="wizardGpsBtn" class="gps-btn">üìç Pobierz z GPS</button>
                </label>
                
                <label>Data i godzina zdarzenia
                  <input type="datetime-local" id="wizardDateTime">
                </label>
                
                <label>Szczeg√≥≈Çy zdarzenia
                  <textarea id="wizardDetails" placeholder="Opisz co siƒô sta≈Ço..."></textarea>
                  <button type="button" id="wizardMicBtn" class="mic-btn">üé§ Nagraj opis</button>
                </label>
                
                <label>E-mail sprawcy (opcjonalnie)
                  <input type="email" id="wizardDriverAEmail" placeholder="np. jan.kowalski@email.com">
                </label>
                
                <label>E-mail poszkodowanego (opcjonalnie)
                  <input type="email" id="wizardDriverBEmail" placeholder="np. anna.nowak@email.com">
                </label>
              </div>
            </div>
          </div>
          
          <div class="wizard-progress">
            <div class="progress-bar">
              <div id="wizardProgress" class="progress-fill"></div>
            </div>
            <div class="progress-text">
              <span id="wizardStepText">Krok 1 z 7</span>
            </div>
          </div>
          
          <div class="wizard-actions">
            <button type="button" id="wizardPrevBtn" class="wizard-btn prev-btn hidden" disabled>‚Üê Poprzedni</button>
            <button type="button" id="wizardSkipBtn" class="wizard-btn skip-btn">‚è≠Ô∏è Pomi≈Ñ</button>
            <button type="button" id="wizardNextBtn" class="wizard-btn next-btn">Nastƒôpny ‚Üí</button>
            <button type="button" id="wizardFinishBtn" class="wizard-btn finish-btn hidden">‚úÖ Zako≈Ñcz i wype≈Çnij formularz</button>
          </div>
        </div>
      </div>
      
      <div class="grid-three">
        <form id="statementForm" class="card">
          <h2>Dane sprawcy kolizji</h2>
          <label>Imiƒô i nazwisko sprawcy
            <input type="text" id="driverAName" placeholder="np. Anna Nowak" required>
          </label>
          <label>Adres zamieszkania sprawcy
            <input type="text" id="driverAAddress" placeholder="ulica, miasto">
          </label>
          <label>E-mail sprawcy
            <input type="email" id="driverAEmail" placeholder="np. anna@example.com">
          </label>
          <label>Prawo jazdy sprawcy (kategoria)
            <input type="text" id="driverALicenseCategory" placeholder="np. B">
          </label>
          <label>Prawo jazdy sprawcy (seria i nr)
            <input type="text" id="driverALicenseNumber" placeholder="np. ABC123456">
          </label>
          <label>Prawo jazdy wydane przez
            <input type="text" id="driverALicenseIssuer" placeholder="np. Starostwo Powiatowe">
          </label>
          <label>Marka pojazdu sprawcy
            <input type="text" id="vehicleAMake" placeholder="np. Toyota">
          </label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" id="vehicleAOtherOwner">
              <span class="checkmark"></span>
              Inny w≈Ça≈õciciel pojazdu sprawcy
            </label>
          </div>
          <label class="vehicle-owner-field hidden" id="vehicleAOwnerLabel">W≈Ça≈õciciel pojazdu sprawcy
            <input type="text" id="vehicleAOwner" placeholder="np. Jan Kowalski">
          </label>
          <label>Numer rejestracyjny pojazdu sprawcy
            <div class="input-with-button">
              <input type="text" id="vehicleAPlate" placeholder="np. KR 12345" required>
              <button type="button" id="verifyPolicyBtn" class="verify-btn">Sprawd≈∫ polisƒô</button>
            </div>
            <div id="policyStatus" class="policy-status hidden"></div>
          </label>
          <label>Polisa OC sprawcy (ubezpieczyciel, nr)
            <input type="text" id="driverAPolicyInfo" placeholder="">
          </label>
          <label>Polisa wa≈ºna do
            <input type="date" id="driverAPolicyValidUntil" placeholder="">
          </label>
        </form>

        <form class="card">
          <h2>Dane poszkodowanego</h2>
          <label>Imiƒô i nazwisko poszkodowanego
            <input type="text" id="driverBName" placeholder="np. Jan Kowalski">
          </label>
          <label>Adres zamieszkania poszkodowanego
            <input type="text" id="driverBAddress" placeholder="ulica, miasto">
          </label>
          <label>E-mail poszkodowanego
            <input type="email" id="driverBEmail" placeholder="np. jan.kowalski@email.com">
          </label>
          <label>Prawo jazdy poszkodowanego (kategoria)
            <input type="text" id="driverBLicenseCategory" placeholder="np. B">
          </label>
          <label>Prawo jazdy poszkodowanego (seria i nr)
            <input type="text" id="driverBLicenseNumber" placeholder="np. ABC123456">
          </label>
          <label>Prawo jazdy wydane przez
            <input type="text" id="driverBLicenseIssuer" placeholder="np. Starostwo Powiatowe">
          </label>
          <label>Marka pojazdu poszkodowanego
            <input type="text" id="vehicleBMake" placeholder="np. Toyota">
          </label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" id="vehicleBOtherOwner">
              <span class="checkmark"></span>
              Inny w≈Ça≈õciciel pojazdu poszkodowanego
            </label>
          </div>
          <label class="vehicle-owner-field hidden" id="vehicleBOwnerLabel">W≈Ça≈õciciel pojazdu poszkodowanego
            <input type="text" id="vehicleBOwner" placeholder="np. Jan Kowalski">
          </label>
          <label>Nr rejestracyjny pojazdu poszkodowanego
            <div class="input-with-button">
              <input type="text" id="vehicleBPlate" placeholder="">
              <button type="button" id="verifyPolicyBBtn" class="verify-btn">Sprawd≈∫ polisƒô</button>
            </div>
            <div id="policyBStatus" class="policy-status hidden"></div>
          </label>
          <label>Polisa OC poszkodowanego (ubezpieczyciel, nr)
            <input type="text" id="driverBPolicyInfo" placeholder="">
          </label>
          <label>Polisa wa≈ºna do
            <input type="date" id="driverBPolicyValidUntil" placeholder="">
          </label>
        </form>

        <form class="card">
          <h2>Dane zdarzenia</h2>
          <label>Miejsce zdarzenia
            <div class="input-with-button">
              <input type="text" id="location" placeholder="np. Krak√≥w, ul. D≈Çuga 12" required>
              <button type="button" id="getLocationBtn" class="location-btn">üìç Pobierz lokalizacjƒô</button>
            </div>
            <div id="locationStatus" class="location-status hidden"></div>
          </label>
          <label>Data i godzina
            <input type="datetime-local" id="datetime" required>
          </label>
          <label>Szczeg√≥≈Çy zdarzenia
            <div class="textarea-with-button">
              <textarea id="incidentDetails" rows="4" placeholder=""></textarea>
              <button type="button" id="dictateBtn" class="dictate-btn-small">üé§ Opisz zdarzenie</button>
            </div>
            <div id="dictationText" class="dictation-text hidden">
              <h3>Opis zdarzenia:</h3>
              <div id="dictationContent" class="dictation-content"></div>
              <div class="dictation-actions">
                <button type="button" id="applyDictationBtn" class="apply-btn">Zastosuj do formularza</button>
                <button type="button" id="clearDictationBtn" class="clear-btn">Wyczy≈õƒá</button>
              </div>
            </div>
          </label>
                  <label>Opis uszkodze≈Ñ pojazdu poszkodowanego
                    <div class="textarea-with-button">
                      <textarea id="damageDescriptionVictim" rows="3" placeholder=""></textarea>
                      <button type="button" id="dictateDamageVictimBtn" class="dictate-btn-small">üé§ Podyktuj</button>
                    </div>
                    <div id="dictationDamageVictimText" class="dictation-text hidden">
                      <h3>Opis uszkodze≈Ñ poszkodowanego:</h3>
                      <div id="dictationDamageVictimContent" class="dictation-content"></div>
                      <div class="dictation-actions">
                        <button type="button" id="applyDictationDamageVictimBtn" class="apply-btn">Zastosuj do formularza</button>
                        <button type="button" id="clearDictationDamageVictimBtn" class="clear-btn">Wyczy≈õƒá</button>
                      </div>
                    </div>
                  </label>
                  <label>Szacunkowa warto≈õƒá szkody pojazdu poszkodowanego (PLN)
                    <input type="number" id="damageValueVictim" placeholder="np. 5000" min="0" step="100">
                  </label>
                  <label>Zdjƒôcia uszkodze≈Ñ pojazdu poszkodowanego (max. 5 zdjƒôƒá)
                    <input type="file" id="victimPhotos" accept="image/*" multiple>
                    <div class="photo-info">Mo≈ºesz wybraƒá maksymalnie 5 zdjƒôƒá</div>
                    <div id="victimPhotosPreviews" class="upload-previews"></div>
                  </label>
                  <label>Opis uszkodze≈Ñ pojazdu sprawcy
                    <div class="textarea-with-button">
                      <textarea id="damageDescriptionPerpetrator" rows="3" placeholder=""></textarea>
                      <button type="button" id="dictateDamagePerpetratorBtn" class="dictate-btn-small">üé§ Podyktuj</button>
                    </div>
                    <div id="dictationDamagePerpetratorText" class="dictation-text hidden">
                      <h3>Opis uszkodze≈Ñ sprawcy:</h3>
                      <div id="dictationDamagePerpetratorContent" class="dictation-content"></div>
                      <div class="dictation-actions">
                        <button type="button" id="applyDictationDamagePerpetratorBtn" class="apply-btn">Zastosuj do formularza</button>
                        <button type="button" id="clearDictationDamagePerpetratorBtn" class="clear-btn">Wyczy≈õƒá</button>
                      </div>
                    </div>
                  </label>
                  <label>Szacunkowa warto≈õƒá szkody pojazdu sprawcy (PLN)
                    <input type="number" id="damageValuePerpetrator" placeholder="np. 3000" min="0" step="100">
                  </label>
                  <label>Zdjƒôcia uszkodze≈Ñ pojazdu sprawcy (max. 5 zdjƒôƒá)
                    <input type="file" id="perpetratorPhotos" accept="image/*" multiple>
                    <div class="photo-info">Mo≈ºesz wybraƒá maksymalnie 5 zdjƒôƒá</div>
                    <div id="perpetratorPhotosPreviews" class="upload-previews"></div>
                  </label>
          <label>Inne uszkodzenia/informacje
            <textarea id="additionalInfo" rows="2" placeholder=""></textarea>
          </label>
        </form>
      </div>

      <!-- Sekcja podpis√≥w -->
      <div class="card signatures-section">
        <h2>Podpisy elektroniczne</h2>
        
        <div class="signature-container">
          <div class="signature-box">
            <h3>Podpis sprawcy kolizji</h3>
            <canvas id="driverASignature" width="400" height="150" class="signature-canvas"></canvas>
            <div class="signature-actions">
              <button type="button" id="clearDriverASignature" class="clear-signature-btn">Wyczy≈õƒá podpis</button>
              <button type="button" id="fullscreenDriverASignature" class="fullscreen-signature-btn">Z≈Ç√≥≈º podpis</button>
              <span id="driverASignatureStatus" class="signature-status">Nie podpisano</span>
            </div>
          </div>
          
          <div class="signature-box">
            <h3>Podpis poszkodowanego</h3>
            <canvas id="driverBSignature" width="400" height="150" class="signature-canvas"></canvas>
            <div class="signature-actions">
              <button type="button" id="clearDriverBSignature" class="clear-signature-btn">Wyczy≈õƒá podpis</button>
              <button type="button" id="fullscreenDriverBSignature" class="fullscreen-signature-btn">Z≈Ç√≥≈º podpis</button>
              <span id="driverBSignatureStatus" class="signature-status">Nie podpisano</span>
            </div>
          </div>
        </div>
        
        <div class="signature-info">
          <p><strong>Instrukcje:</strong></p>
          <ul>
            <li>Kliknij i przeciƒÖgnij myszkƒÖ/palcem po obszarze podpisu</li>
            <li>Podpis jest wymagany przed wys≈Çaniem o≈õwiadczenia</li>
            <li>Mo≈ºesz wyczy≈õciƒá podpis i podpisaƒá ponownie</li>
          </ul>
        </div>
      </div>

      <!-- PodglƒÖd o≈õwiadczenia -->
      <div class="card" id="previewCard">
        <h2>PodglƒÖd o≈õwiadczenia</h2>
        <pre id="preview"></pre>
      </div>

      <div class="actions-section">
        <div class="approval-section">
          <button type="button" id="approveBtn" class="approve-btn">‚úì Zatwierd≈∫ o≈õwiadczenie</button>
          <div id="approvalStatus" class="approval-status hidden">
            <span class="approval-icon">‚úì</span>
            <span class="approval-text">O≈õwiadczenie zatwierdzone</span>
          </div>
        </div>
        <div class="actions">
          <button type="button" id="emailBtn" class="action-btn disabled" disabled>Wy≈õlij na e-mail</button>
          <button type="button" id="downloadBtn" class="action-btn disabled" disabled>Pobierz o≈õwiadczenie</button>
        </div>
      </div>

      <!-- Modal QR -->
      <div id="qrModal" class="modal hidden">
        <div class="modal-content">
          <h3>Zeskanuj QR mObywatel</h3>
          <p>W PoC mo≈ºesz wpisaƒá token JSON albo u≈ºyƒá kamery (symulacja poni≈ºej).</p>
          <textarea id="qrTokenInput" rows="6" placeholder='{"driverB":{"name":"Jan Kowalski","policyNumber":"POL-PL-123456","vehiclePlate":"WX 12345"}}'></textarea>
          <div class="modal-actions">
            <button id="qrSubmit">U≈ºyj tokenu</button>
            <button id="qrClose">Zamknij</button>
          </div>
        </div>
      </div>

      <!-- Modal rƒôcznego wklejenia/napisania o≈õwiadczenia (fallback zamiast Web Speech API) -->
      <div id="manualModal" class="modal hidden">
        <div class="modal-content">
          <h3>Wpisz lub wklej tre≈õƒá o≈õwiadczenia</h3>
          <p>Na tym urzƒÖdzeniu rozpoznawanie mowy w przeglƒÖdarce nie jest wspierane. Mo≈ºesz u≈ºyƒá mikrofonu klawiatury telefonu i wkleiƒá tekst poni≈ºej.</p>
          <textarea id="manualText" rows="8" placeholder="Opisz zdarzenie, podaj dane A/B, numery rejestracyjne, miejsce, datƒô..."></textarea>
          <div class="modal-actions">
            <button id="manualAnalyze">Wy≈õlij do AI</button>
            <button id="manualClose">Zamknij</button>
          </div>
        </div>
      </div>

      <!-- Modal nagrywania audio (Mobile iOS/Android) -->
      <div id="recordModal" class="modal hidden">
        <div class="modal-content">
          <h3>Nagraj o≈õwiadczenie (audio)</h3>
          <p>Wci≈õnij ‚ÄûStart‚Äù, a po zako≈Ñczeniu ‚ÄûStop‚Äù, nastƒôpnie ‚ÄûWy≈õlij do AI‚Äù.</p>
          <div class="actions">
            <button id="recStart">Start</button>
            <button id="recStop" disabled>Stop</button>
            <button id="recSend" disabled>Wy≈õlij do AI</button>
            <button id="recClose">Zamknij</button>
          </div>
          <audio id="recPreview" controls class="hidden"></audio>
        </div>
      </div>
    </div>

    <!-- jsPDF for PDF export -->
    <script src="/node_modules/jspdf/dist/jspdf.umd.min.js"></script>
    <script src="/main.js"></script>
    <!-- Modal do wy≈õwietlania zdjƒôƒá w powiƒôkszeniu -->
  <div id="imageModal" class="image-modal">
    <div class="image-content">
      <span class="image-close">&times;</span>
      <img id="modalImage" src="" alt="Powiƒôkszone zdjƒôcie">
    </div>
  </div>

  <!-- Pe≈Çnoekranowy modal do podpisywania -->
    <div id="fullscreenSignatureModal" class="fullscreen-signature-modal">
      <div class="fullscreen-signature-content">
        <div class="fullscreen-signature-header">
          <h3 id="fullscreenSignatureTitle">Z≈Ç√≥≈º podpis</h3>
          <div class="fullscreen-signature-actions">
            <button type="button" id="fullscreenClearSignature" class="fullscreen-clear-btn">Wyczy≈õƒá</button>
            <button type="button" id="fullscreenSaveSignature" class="fullscreen-save-btn">Zapisz podpis</button>
            <button type="button" id="fullscreenCloseSignature" class="fullscreen-close-btn">‚úï</button>
          </div>
        </div>
        <canvas id="fullscreenSignatureCanvas" class="fullscreen-signature-canvas"></canvas>
        <div class="fullscreen-signature-instructions">
          <p>Podpisz siƒô palcem lub myszkƒÖ. Po zako≈Ñczeniu kliknij "Zapisz podpis".</p>
        </div>
      </div>
    </div>

  </body>
</html>


